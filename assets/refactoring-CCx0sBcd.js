import{r as j,j as e,c as E,R as L}from"./client-DD4c7S6m.js";const Q=t=>{const{quantity:n,product:a}=t,d=a.discounts.filter(l=>n>=l.quantity).map(l=>l.rate);return d.length>0?Math.max(...d):0},B=t=>{const n=Q(t);return Math.floor(t.product.price*t.quantity*(1-n))},O=(t,n)=>{const a=t.reduce((m,i)=>m+i.product.price*i.quantity,0),d=t.reduce((m,i)=>m+i.product.price*i.quantity-B(i),0);let l=0;const u=a-d;n&&(n.discountType==="amount"?l=n.discountValue:n.discountType==="percentage"&&(l=Math.floor(u*n.discountValue/100)));const b=d+l,r=a-b;return{totalBeforeDiscount:a,totalAfterDiscount:r,totalDiscount:b}},P=(t,n,a)=>a<=0?t.filter(d=>d.product.id!==n):t.map(d=>{if(d.product.id!==n)return d;const l=Math.min(a,d.product.stock);return{...d,quantity:l}}),U=()=>{const[t,n]=j.useState([]),[a,d]=j.useState(null);return{cart:t,selectedCoupon:a,addToCart:i=>{n(g=>{const x=g.find(N=>N.product.id===i.id);return x?P(g,i.id,x.quantity+1):[...g,{product:i,quantity:1}]})},removeFromCart:i=>{n(g=>g.filter(x=>x.product.id!==i))},updateQuantity:(i,g)=>{n(x=>P(x,i,g))},applyCoupon:i=>{d(i)},calculateTotal:()=>O(t,a)}},H=t=>{const[n,a]=j.useState(t);return{coupons:n,addCoupon:l=>{a(u=>[...u,l])}}},W=t=>{const[n,a]=j.useState(t);return{products:n,updateProduct:u=>{a(b=>b.map(r=>r.id===u.id?u:r))},addProduct:u=>{a(b=>[...b,u])}}},_=t=>t.reduce((n,a)=>Math.max(n,a.rate),0),z=(t,n)=>{const a=n.find(d=>d.product.id===t.id);return t.stock-((a==null?void 0:a.quantity)||0)},G=t=>{const{discounts:n}=t.product,{quantity:a}=t;return n.filter(d=>a>=d.quantity).reduce((d,l)=>Math.max(d,l.rate),0)},w=({children:t,className:n="",...a})=>e.jsx("button",{className:`px-3 py-1 rounded bg-blue-500 text-white hover:bg-blue-600 disabled:bg-gray-300 disabled:text-gray-500 ${n}`,...a,children:t}),k=({children:t,className:n="",...a})=>e.jsx("div",{className:`bg-white p-3 rounded shadow ${n}`,...a,children:t}),J=({product:t,remainingStock:n,onAddToCart:a})=>e.jsxs(k,{"data-testid":`product-${t.id}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[t.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${n>0?"text-green-600":"text-red-600"}`,children:["재고: ",n,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(_(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((d,l)=>e.jsxs("li",{children:[d.quantity,"개 이상: ",(d.rate*100).toFixed(0),"% 할인"]},l))}),e.jsx(w,{onClick:a,disabled:n<=0,className:"w-full",children:n>0?"장바구니에 추가":"품절"})]}),K=({item:t,onIncrease:n,onDecrease:a,onRemove:d})=>{const l=G(t);return e.jsxs(k,{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price.toLocaleString(),"원 x ",t.quantity,l>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(l*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx(w,{onClick:a,className:"mr-1 bg-gray-300 text-gray-800 hover:bg-gray-400",children:"-"}),e.jsx(w,{onClick:n,className:"mr-1 bg-gray-300 text-gray-800 hover:bg-gray-400",children:"+"}),e.jsx(w,{onClick:d,className:"bg-red-500 hover:bg-red-600",children:"삭제"})]})]})},y=({children:t,level:n=1,className:a=""})=>{const d=["h1","h2","h3"][n-1],l=n===1?"text-3xl font-bold":n===2?"text-2xl font-semibold":"text-xl font-medium";return e.jsx(d,{className:`${l} ${a}`,children:t})},X=({products:t,coupons:n})=>{const{cart:a,addToCart:d,removeFromCart:l,updateQuantity:u,applyCoupon:b,calculateTotal:r,selectedCoupon:m}=U(),{totalBeforeDiscount:i,totalAfterDiscount:g,totalDiscount:x}=r();return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx(y,{level:1,children:"장바구니"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(y,{level:2,children:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(o=>e.jsx(J,{product:o,remainingStock:z(o,a),onAddToCart:()=>d(o)},o.id))})]}),e.jsxs("div",{children:[e.jsx(y,{level:2,children:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:a.map(o=>e.jsx(K,{item:o,onIncrease:()=>u(o.product.id,o.quantity+1),onDecrease:()=>u(o.product.id,o.quantity-1),onRemove:()=>l(o.product.id)},o.product.id))}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(y,{level:2,children:"쿠폰 적용"}),e.jsxs("select",{onChange:o=>b(n[parseInt(o.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),n.map((o,N)=>e.jsxs("option",{value:N,children:[o.name," - ",o.discountType==="amount"?`${o.discountValue}원`:`${o.discountValue}%`]},o.code))]}),m&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",m.name,"(",m.discountType==="amount"?`${m.discountValue}원`:`${m.discountValue}%`," 할인)"]})]}),e.jsxs("div",{className:"mt-6 bg-white p-4 rounded shadow",children:[e.jsx(y,{level:2,children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",i.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",x.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",g.toLocaleString(),"원"]})]})]})]})]})]})},Y=({products:t,coupons:n,onProductUpdate:a,onProductAdd:d,onCouponAdd:l})=>{const[u,b]=j.useState(new Set),[r,m]=j.useState(null),[i,g]=j.useState({quantity:0,rate:0}),[x,o]=j.useState({name:"",code:"",discountType:"percentage",discountValue:0}),[N,C]=j.useState(!1),[v,f]=j.useState({name:"",price:0,stock:0,discounts:[]}),S=s=>{b(h=>{const c=new Set(h);return c.has(s)?c.delete(s):c.add(s),c})},q=s=>{m({...s})},T=(s,h)=>{if(r&&r.id===s){const c={...r,name:h};m(c)}},D=(s,h)=>{if(r&&r.id===s){const c={...r,price:h};m(c)}},A=()=>{r&&(a(r),m(null))},V=(s,h)=>{const c=t.find(p=>p.id===s);if(c){const p={...c,stock:h};a(p),m(p)}},$=s=>{const h=t.find(c=>c.id===s);if(h&&r){const c={...h,discounts:[...h.discounts,i]};a(c),m(c),g({quantity:0,rate:0})}},I=(s,h)=>{const c=t.find(p=>p.id===s);if(c){const p={...c,discounts:c.discounts.filter((se,R)=>R!==h)};a(p),m(p)}},F=()=>{l(x),o({name:"",code:"",discountType:"percentage",discountValue:0})},M=()=>{const s={...v,id:Date.now().toString()};d(s),f({name:"",price:0,stock:0,discounts:[]}),C(!1)};return e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"관리자 페이지"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"상품 관리"}),e.jsx("button",{onClick:()=>C(!N),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:N?"취소":"새 상품 추가"}),N&&e.jsxs("div",{className:"bg-white p-4 rounded shadow mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700",children:"상품명"}),e.jsx("input",{id:"productName",type:"text",value:v.name,onChange:s=>f({...v,name:s.target.value}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productPrice",className:"block text-sm font-medium text-gray-700",children:"가격"}),e.jsx("input",{id:"productPrice",type:"number",value:v.price,onChange:s=>f({...v,price:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"productStock",className:"block text-sm font-medium text-gray-700",children:"재고"}),e.jsx("input",{id:"productStock",type:"number",value:v.stock,onChange:s=>f({...v,stock:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:M,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),e.jsx("div",{className:"space-y-2",children:t.map((s,h)=>e.jsxs("div",{"data-testid":`product-${h+1}`,className:"bg-white p-4 rounded shadow",children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>S(s.id),className:"w-full text-left font-semibold",children:[s.name," - ",s.price,"원 (재고: ",s.stock,")"]}),u.has(s.id)&&e.jsx("div",{className:"mt-2",children:r&&r.id===s.id?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"상품명: "}),e.jsx("input",{type:"text",value:r.name,onChange:c=>T(s.id,c.target.value),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"가격: "}),e.jsx("input",{type:"number",value:r.price,onChange:c=>D(s.id,parseInt(c.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-1",children:"재고: "}),e.jsx("input",{type:"number",value:r.stock,onChange:c=>V(s.id,parseInt(c.target.value)),className:"w-full p-2 border rounded"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),r.discounts.map((c,p)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[c.quantity,"개 이상 구매 시 ",c.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>I(s.id,p),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},p)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"number",placeholder:"수량",value:i.quantity,onChange:c=>g({...i,quantity:parseInt(c.target.value)}),className:"w-1/3 p-2 border rounded"}),e.jsx("input",{type:"number",placeholder:"할인율 (%)",value:i.rate*100,onChange:c=>g({...i,rate:parseInt(c.target.value)/100}),className:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>$(s.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:A,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[s.discounts.map((c,p)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[c.quantity,"개 이상 구매 시 ",c.rate*100,"% 할인"]})},p)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>q(s),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"쿠폰 관리"}),e.jsxs("div",{className:"bg-white p-4 rounded shadow",children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"쿠폰 이름",value:x.name,onChange:s=>o({...x,name:s.target.value}),className:"w-full p-2 border rounded"}),e.jsx("input",{type:"text",placeholder:"쿠폰 코드",value:x.code,onChange:s=>o({...x,code:s.target.value}),className:"w-full p-2 border rounded"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:x.discountType,onChange:s=>o({...x,discountType:s.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx("input",{type:"number",placeholder:"할인 값",value:x.discountValue,onChange:s=>o({...x,discountValue:parseInt(s.target.value)}),className:"w-full p-2 border rounded"})]}),e.jsx("button",{onClick:F,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"현재 쿠폰 목록"}),e.jsx("div",{className:"space-y-2",children:n.map((s,h)=>e.jsxs("div",{"data-testid":`coupon-${h+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," 할인"]},h))})]})]})]})]})]})},Z=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}],ee=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],te=()=>{const{products:t,updateProduct:n,addProduct:a}=W(Z),{coupons:d,addCoupon:l}=H(ee),[u,b]=j.useState(!1);return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("nav",{className:"bg-blue-600 text-white p-4",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"쇼핑몰 관리 시스템"}),e.jsx("button",{onClick:()=>b(!u),className:"bg-white text-blue-600 px-4 py-2 rounded hover:bg-blue-100",children:u?"장바구니 페이지로":"관리자 페이지로"})]})}),e.jsx("main",{className:"container mx-auto mt-6",children:u?e.jsx(Y,{products:t,coupons:d,onProductUpdate:n,onProductAdd:a,onCouponAdd:l}):e.jsx(X,{products:t,coupons:d})})]})};E.createRoot(document.getElementById("root")).render(e.jsx(L.StrictMode,{children:e.jsx(te,{})}));
